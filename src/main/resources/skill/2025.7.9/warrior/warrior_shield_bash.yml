__option__:
  # 技能名称
  name: "盾击"
  # 是否异步执行
  async: false
  # 图标配置
  icon-formatter:
    # 物品材质
    material: SHIELD
    # 显示名称
    name: "盾击"
    # 描述信息
    lore:
      - "技能等级 {{ ctx skill level }}"
      - "技能伤害 {{ lazy *damage }}"
      - "冷却时间 {{ lazy *cooldown }}秒"
      - "消耗法力 {{ lazy *mp_cost }}"
      - "使用盾牌进行冲击攻击并眩晕敌人"
  # 技能分类
  category: 
    - "战士"
    - "小技能"
  # 变量定义
  variables:
    # 冷却时间(tick)
    cooldown: 80
    # 伤害计算公式
    damage: math 30 + ctx skill level * 8
    # 法力消耗
    mp_cost: 25
    # 攻击范围
    attack_range: 2.5
    # 眩晕时间(tick)
    stun_duration: 40
    # 技能权重
    skill_weight: 0.8
# 技能脚本
action: |
  def main = {
    # 检查玩家状态是否允许释放技能
    if any [ check metadata 状态 contains 前摇 check metadata 控制 contains 沉默 check metadata 状态 contains 硬直 ] then {
      # 重置冷却时间并退出
      cooldown reset
      exit success
    }
    # 检查是否装备盾牌
    if not inventory offhand is "minecraft:shield" then {
      tell "需要装备盾牌才能使用此技能！"
      cooldown reset
      exit success
    }
    # 检查法力值是否足够
    if check profile mp < lazy mp_cost then {
      tell "法力不足！"
      cooldown reset
      exit success
    }
    # 初始化玩家状态
    call initPlayerState
    # 等待前摇时间
    wait 0.2s
    # 执行冲击
    call executeBash
    # 等待后摇时间
    wait 0.3s
    # 结束技能效果
    call endSkill
  }
  def initPlayerState = {
    # 消耗法力值
    profile mp take lazy mp_cost
    # 设置前摇状态
    metadata 状态 to 前摇_盾击 timeout 8
    # 播放技能动画
    command inline "gp model cast {{ player name }} warrior_shield_bash_animation" as console
    # 播放音效
    command inline "gp sound play {{ player name }} warrior_shield_bash_sound player" as console
    # 向前冲刺
    velocity move "0 0 0.8" at @sender
  }
  def executeBash = {
    # 检查是否仍在前摇状态
    if not check metadata 状态 contains 前摇_盾击 then {
      exit success
    }
    # 选择攻击目标
    set targets to select @rectangle 2 2 lazy attack_range offset "0 0 1" debug false @their
    # 对目标造成伤害
    ap-attack 技能权重+lazy skill_weight,钝选择+12 at &targets
    # 对目标施加眩晕效果
    metadata 控制 to 眩晕 timeout lazy stun_duration at &targets
    # 播放击中特效
    mythic mob signal ShieldBashImpact at &targets
    # 设置后摇状态
    metadata 状态 to 后摇_盾击 timeout 8
  }
  def endSkill = {
    # 停止动画
    command inline "gp model stop {{ player name }} warrior_shield_bash_animation" as console
  }
