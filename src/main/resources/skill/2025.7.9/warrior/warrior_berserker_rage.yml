__option__:
  # 技能名称
  name: "狂暴之怒"
  # 是否异步执行
  async: false
  # 图标配置
  icon-formatter:
    # 物品材质
    material: REDSTONE
    # 显示名称
    name: "狂暴之怒"
    # 描述信息
    lore:
      - "技能等级 ${ctx skill level}"
      - "攻击力提升 ${*attack_boost}%"
      - "冷却时间 ${*cooldown}秒"
      - "消耗法力 ${*mp_cost}"
      - "持续时间 ${*duration}秒"
      - "进入狂暴状态，大幅提升攻击力和攻击速度"
  # 技能分类
  category:
    - "战士"
    - "大技能"
  # 变量定义
  variables:
    # 冷却时间(tick)
    cooldown: 600
    # 法力消耗
    mp_cost: 100
    # 持续时间(tick)
    duration: 200
    # 攻击力提升百分比
    attack_boost: 50 + ctx skill level * 10
    # 攻击速度提升
    attack_speed_boost: 3
    # 移动速度提升
    speed_boost: 2
# 技能脚本
action: |
  fn main() {
    # 检查玩家状态是否允许释放技能
    if sender :: metadataContains("状态", "前摇") || sender :: metadataContains("控制", "沉默") || sender :: metadataContains("状态", "硬直") {
      # 重置冷却时间并退出
      sender :: resetCooldown(skill)
      return
    }
    # 检查是否已经在狂暴状态
    if sender :: metadataContains("状态", "狂暴") {
      sender :: sendMessage("已经处于狂暴状态！")
      sender :: resetCooldown(skill)
      return
    }
    # 检查法力值是否足够
    if check profile mp < *mp_cost {
      sender :: sendMessage("法力不足！")
      sender :: resetCooldown(skill)
      return
    }
    # 激活狂暴状态
    activateBerserkerRage()
    # 等待持续时间
    "wait" :: delayTicks(*duration)
    # 结束狂暴状态
    deactivateBerserkerRage()
  }
  fn activateBerserkerRage() {
    # 消耗法力值
    profile mp take *mp_cost
    # 设置狂暴状态
    sender :: setMetadata("状态", "狂暴", *duration)
    # 播放激活动画
    "gp model cast ${sender :: name()} warrior_berserker_activate_animation" :: executeAsConsole()
    # 播放激活音效
    "gp sound play ${sender :: name()} warrior_berserker_activate_sound player" :: executeAsConsole()
    # 添加攻击力提升属性
    attribute add "狂暴攻击力" duration *duration inline "攻击力+${*attack_boost}%" at @self
    # 添加攻击速度提升效果
    "effect ${sender :: name()} haste *attack_speed_boost *duration" :: executeAsConsole()
    # 添加移动速度提升效果
    "effect ${sender :: name()} speed *speed_boost *duration" :: executeAsConsole()
    # 播放狂暴特效
    "gp effect spawn ${sender :: name()} warrior_berserker_effect ${sender :: name()}狂暴特效 ${sender}" :: executeAsConsole()
    # 发送提示消息
    sender :: sendMessage("进入狂暴状态！攻击力和速度大幅提升！")
  }
  fn deactivateBerserkerRage() {
    # 移除狂暴状态
    metadata 状态 remove 狂暴
    # 移除攻击力提升属性
    attribute remove "狂暴攻击力"
    # 移除速度效果
    "effect ${sender :: name()} haste 0" :: executeAsConsole()
    "effect ${sender :: name()} speed 0" :: executeAsConsole()
    # 停止特效
    "gp effect stop ${sender :: name()} warrior_berserker_effect" :: executeAsConsole()
    # 播放结束音效
    "gp sound play ${sender :: name()} warrior_berserker_end_sound player" :: executeAsConsole()
    # 发送提示消息
    sender :: sendMessage("狂暴状态结束。")
  }
