__option__:
  # 技能名称
  name: "狂暴之怒"
  # 是否异步执行
  async: false
  # 图标配置
  icon-formatter:
    # 物品材质
    material: REDSTONE
    # 显示名称
    name: "狂暴之怒"
    # 描述信息
    lore:
      - "技能等级 {{ ctx skill level }}"
      - "攻击力提升 {{ lazy *attack_boost }}%"
      - "冷却时间 {{ lazy *cooldown }}秒"
      - "消耗法力 {{ lazy *mp_cost }}"
      - "持续时间 {{ lazy *duration }}秒"
      - "进入狂暴状态，大幅提升攻击力和攻击速度"
  # 技能分类
  category: 
    - "战士"
    - "大技能"
  # 变量定义
  variables:
    # 冷却时间(tick)
    cooldown: 600
    # 法力消耗
    mp_cost: 100
    # 持续时间(tick)
    duration: 200
    # 攻击力提升百分比
    attack_boost: math 50 + ctx skill level * 10
    # 攻击速度提升
    attack_speed_boost: 3
    # 移动速度提升
    speed_boost: 2
# 技能脚本
action: |
  def main = {
    # 检查玩家状态是否允许释放技能
    if any [ check metadata 状态 contains 前摇 check metadata 控制 contains 沉默 check metadata 状态 contains 硬直 ] then {
      # 重置冷却时间并退出
      cooldown reset
      exit success
    }
    # 检查是否已经在狂暴状态
    if check metadata 状态 contains 狂暴 then {
      tell "已经处于狂暴状态！"
      cooldown reset
      exit success
    }
    # 检查法力值是否足够
    if check profile mp < lazy mp_cost then {
      tell "法力不足！"
      cooldown reset
      exit success
    }
    # 激活狂暴状态
    call activateBerserkerRage
    # 等待持续时间
    wait lazy duration tick
    # 结束狂暴状态
    call deactivateBerserkerRage
  }
  def activateBerserkerRage = {
    # 消耗法力值
    profile mp take lazy mp_cost
    # 设置狂暴状态
    metadata 状态 to 狂暴 timeout lazy duration
    # 播放激活动画
    command inline "gp model cast {{ player name }} warrior_berserker_activate_animation" as console
    # 播放激活音效
    command inline "gp sound play {{ player name }} warrior_berserker_activate_sound player" as console
    # 添加攻击力提升属性
    attribute add "狂暴攻击力" duration lazy duration inline "攻击力+{{ lazy attack_boost }}%" at @self
    # 添加攻击速度提升效果
    command inline "effect {{ player name }} haste lazy attack_speed_boost lazy duration" as console
    # 添加移动速度提升效果
    command inline "effect {{ player name }} speed lazy speed_boost lazy duration" as console
    # 播放狂暴特效
    command inline "gp effect spawn {{ player name }} warrior_berserker_effect {{ player name }}狂暴特效 {{ sender }}" as console
    # 发送提示消息
    tell "进入狂暴状态！攻击力和速度大幅提升！"
  }
  def deactivateBerserkerRage = {
    # 移除狂暴状态
    metadata 状态 remove 狂暴
    # 移除攻击力提升属性
    attribute remove "狂暴攻击力"
    # 移除速度效果
    command inline "effect {{ player name }} haste 0" as console
    command inline "effect {{ player name }} speed 0" as console
    # 停止特效
    command inline "gp effect stop {{ player name }} warrior_berserker_effect" as console
    # 播放结束音效
    command inline "gp sound play {{ player name }} warrior_berserker_end_sound player" as console
    # 发送提示消息
    tell "狂暴状态结束。"
  }
